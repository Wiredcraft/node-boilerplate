var path = require('path');
var fs = require('fs');
var _ = require('underscore');

// .
require('./lib/plugin')(exports);

// Plugins.
exports.register(__dirname, 'plugins');

// Constructors.
exports.register(__dirname, 'constructors');

// .
_.each(exports.constructors, function(obj) {
    // .
    exports.mixable(obj);
    // .
    exports.mixable(obj.prototype);
    // .
    obj.mixin('plugins', 'extendable');
});

// ----
// Demo
// ----
var http = require('http');
var express = require('express');

// .
exports.start = function() {
    var app = express();

    app.configure(function() {
        app.set('port', process.env.PORT || 3000);
        app.use(express.favicon());
        app.use(express.logger('dev'));
        app.use(express.bodyParser());
        app.use(express.methodOverride());
        app.use(express.cookieParser('your secret here'));
        app.use(express.session());
    });

    app.configure('development', function() {
        app.use(express.errorHandler());
    });

    app.get('/', function(req, res) {
        res.json({
            title: 'Express'
        });
    });

    http.createServer(app).listen(app.get('port'), function() {
        console.log('Express server listening on port ' + app.get('port'));
    });
};
